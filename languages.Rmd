---
title: "Programming languages"
---
```{r config, include=FALSE}
library(knitr)
opts_chunk$set(echo=FALSE, message=FALSE, warning=FALSE,
               fig.width=4, fig.height=4,
               cache=FALSE)
read_chunk("languages.R")
```
```{r setup}
```

## Representativeness

```{r frequency, fig.width=8}
top20_language_summary %<>% order_language_by("frequency_rank", reverse = TRUE)
freq_plot <- ggplot(top20_language_summary) +
  aes(language_ordered, frequency) +
  geom_bar(stat = "identity") +
  geom_text(aes(label = language_name), nudge_y = 2, hjust = 0) +
  scale_x_discrete("", labels = c(">20", 20:1)) +
  scale_y_continuous(breaks = seq(0, 400, by = 50)) +
  coord_flip(ylim = c(0, 360), expand = FALSE) +
  labs(x = "", y = "", title = "Frequency") +
  theme_minimal()

survey_languages <- collect_table("languages") %>%
  count(language_name) %>%
  arrange(desc(n)) %>%
  mutate(survey_rank = 1:n()) %>%
  select(language_name, survey_rank)

stack_overflow <- collect_table("stack_overflow") %>%
  count(language_name) %>%
  arrange(desc(n)) %>%
  mutate(stack_overflow_rank = 1:n()) %>%
  select(language_name, stack_overflow_rank)
  
compare_ranks <- left_join(survey_languages, stack_overflow)
rank_corr_plot <- ggplot(compare_ranks) +
  aes(survey_rank, stack_overflow_rank) +
  geom_point() +
  geom_abline(intercept = 0, slope = 1) +
  geom_label(aes(label = language_name), data = filter(compare_ranks, survey_rank <= 20)) +
  scale_x_reverse(breaks = c(1, seq(5, 30, by = 5)), position = "top") +
  scale_y_reverse(breaks = c(1, seq(5, 30, by = 5)), position = "right") +
  coord_cartesian(xlim = c(0, 30), ylim = c(0, 30), expand = FALSE) +
  labs(x = "Rank in Sample", y = "Stack Overflow Rank") +
  theme_minimal()

gridExtra::grid.arrange(freq_plot, rank_corr_plot, nrow = 1)
```

## Experience

```{r languages-per-person}
```

## Proficiency

```{r proficiency}
top20_language_summary %<>% order_language_by("proficiency_rank", reverse = TRUE)
ggplot(top20_language_summary) +
  aes(language_ordered, proficiency) +
  geom_point(stat = "identity") +
  xlab("") +
  coord_flip(ylim = c(1, 5)) +
  labs(x = "", title = "Proficiency")
```

## Rank correlations

```{r correlations}
top20_language_summary %>%
  rank_by("proficiency") %>%
  rank_by("years_used") %>%
  filter(language_name != "other") %>%
  select(-c(frequency, proficiency, years_used, language_ordered)) %>%
  gather(rank_var, rank, -language_name) %>%
ggplot() +
  aes(rank_var, rank, group = language_name) +
  geom_line() +
  scale_y_reverse(breaks = 1:20, labels = top20_languages) +
  theme(
    panel.grid.minor.y = element_blank()
  ) +
  labs(x = "", y = "", title = "Rank correlations")
```

```{r experience-proficiency-correlation, fig.width=8, fig.height=6}
library(ggrepel)
set.seed(543)
ggplot(filter(top20_language_summary, language_name != "other")) +
  aes(years_used, proficiency) +
  geom_point(data = filter(language_summary, !(language_name %in% top20_languages))) +
  geom_label_repel(aes(label = language_name)) +
  ggtitle("Experience-proficiency correlation")
```

## Intuitiveness

```{r intuitiveness, fig.width=6}
top20_intuitive <- filter(top20_ratings_summary, question_name == "intuitiveness")

top20_intuitive_for_all_levels <- top20_intuitive %>%
  filter(question_tag == "forAll") %>%
  rank_by("agreement_num") %>%
  order_language_by("agreement_num_rank", levels_only = TRUE)
top20_intuitive %<>% order_language_by(use_levels = top20_intuitive_for_all_levels, reverse = TRUE)

ggplot(top20_intuitive) +
  aes(language_ordered, agreement_num) +
  geom_point() +
  coord_flip(ylim = 1:5) +
  scale_y_continuous(breaks = 1:5) +
  facet_wrap("question_tag") +
  labs(x = "", y = "", title = "Intuitiveness")
```

## Reuse

```{r reuse, fig.width=6}
top20_reuse_adaptive_levels <- top20_reuse %>%
  filter(question_tag == "adapt") %>%
  rank_by("agreement_num") %>%
  order_language_by("agreement_num_rank", levels_only = TRUE)
top20_reuse %<>% order_language_by(use_levels = top20_reuse_adaptive_levels, reverse = TRUE)

ggplot(top20_reuse) +
  aes(language_ordered, agreement_num) +
  geom_point() +
  coord_flip(ylim = 1:5) +
  scale_y_continuous(breaks = 1:5) +
  facet_wrap("reuse_label") +
  labs(x = "", y = "", title = "Reuse")
```

## Paradigms

```{r top-paradigms, results="asis"}
kable(top_paradigms_tbl)
```

```{r paradigms-of-top-languages, results="asis"}
kable(top20_language_paradigms)
```

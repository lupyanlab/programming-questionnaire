---
title: Programming languages
---
```{r config, include=FALSE}
library(knitr)
library(tidyverse)
opts_chunk$set(echo=FALSE, dpi=200)
```

# Top languages

```{r top-languages, echo=1:2}
source("R/sqlite.R")
languages <- collect_table("languages")
kable(head(languages))

frequencies <- languages %>%
  count(language_name) %>%
  arrange(desc(n)) %>%
  mutate(rank = 1:n())

top20_languages <- filter(frequencies, rank <= 20)$language_name

# Set factor levels as order in plot
levels <- rev(frequencies$language_name)
frequencies$language_ordered <- factor(frequencies$language_name, levels = levels)

ggplot(filter(frequencies, language_name %in% top20_languages)) +
  aes(language_ordered, n) +
  geom_bar(stat = "identity") +
  xlab("") +
  coord_flip()
```

```{r most-experience}
most_experience <- languages %>%
  group_by(language_name) %>%
  summarize(
    n = n(),
    proficiency = mean(proficiency, na.rm = TRUE),
    years_used = mean(years_used, na.rm = TRUE)
  )

# Set factor levels as order in plot
most_experience$language_ordered <- factor(most_experience$language_name, levels = levels)

ggplot(filter(most_experience, language_name %in% top20_languages)) +
  aes(language_ordered, years_used) +
  geom_bar(stat = "identity") +
  xlab("") +
  coord_flip() +
  ggtitle("Years experience")

ggplot(filter(most_experience, language_name %in% top20_languages)) +
  aes(language_ordered, proficiency) +
  geom_point(stat = "identity") +
  xlab("") +
  coord_flip(ylim = c(1, 5)) +
  ggtitle("Proficiency")
```

# Language ratings

```{r, echo=1}
language_ratings <- collect_table("language_ratings")
kable(head(language_ratings))
```

## Intuitiveness

```{r intuitiveness}
source("R/question-types.R")

intuitiveness <- collect_table("language_ratings") %>%
  filter(question_name == "intuitiveness") %>%
  select(subj_id, language_name, question_tag, agreement_num) %>%
  drop_na() %>%
  group_by(language_name, question_tag) %>%
  summarize(
    n = n(),
    agreement_num = mean(agreement_num, na.rm = TRUE)
  ) %>%
  ungroup()

top20_intuitive <- filter(intuitiveness, language_name %in% top20_languages)

intuitive_for_all <- top20_intuitive %>%
  filter(question_tag == "forAll") %>%
  arrange(agreement_num) %>%
  .$language_name

top20_intuitive$language_ordered <- factor(top20_intuitive$language_name, levels = intuitive_for_all)

ggplot(top20_intuitive) +
  aes(language_ordered, agreement_num) +
  geom_point() +
  coord_flip(ylim = 1:5) +
  scale_y_continuous("Agreement", breaks = 1:5, labels = rev(recode_agreement()$agreement_label)) +
  facet_wrap("question_tag") +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1)
  ) +
  xlab("")
```

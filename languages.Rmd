---
title: Programming languages
---
```{r config, include=FALSE}
library(knitr)
library(tidyverse)
library(magrittr)
opts_chunk$set(echo=FALSE, dpi=200)
```

# Top languages

```{r top-languages, echo=1:2}
source("R/sqlite.R")
languages <- collect_table("languages")
kable(head(languages))

# Create rank columns for ordering languages
rank_by <- function(frame, values, rank_col_str = paste0(values, "_rank")) {
  frame[rank_col_str] <- rank(-frame[values], ties.method = "first")
  frame
}

# Order language by rank column
order_language_by <- function(frame, rank_col, levels_only = FALSE, reverse = FALSE) {
  levels <- frame %>%
    arrange_(.dots = list(rank_col)) %>%
    .$language_name
  if(reverse) levels <- rev(levels)
  if(levels_only) return(levels)
  frame$language_ordered <- factor(frame$language_name, levels = levels)
  frame
}

language_summary <- languages %>%
  group_by(language_name) %>%
  summarize(
    frequency = n(),
    proficiency = mean(proficiency, na.rm = TRUE),
    years_used = mean(years_used, na.rm = TRUE)
  ) %>%
  rank_by("frequency") %>%
  rank_by("years_used") %>%
  rank_by("proficiency")

# must be ordered!
top20_languages <- order_language_by(language_summary, "frequency_rank", levels_only = TRUE)[1:20]

not_top20_language_summary <- language_summary %>%
  filter(!(language_name %in% top20_languages)) %>%
  summarize(
    frequency = sum(frequency, na.rm = TRUE),
    years_used = mean(years_used, na.rm = TRUE),
    proficiency = mean(proficiency, na.rm = TRUE),
    frequency_rank = Inf,
    years_used_rank = Inf,
    proficiency_rank = Inf
  ) %>%
  mutate(language_name = "other")

top20_language_summary <- language_summary %>%
  filter(language_name %in% top20_languages) %>%
  bind_rows(not_top20_language_summary)
```

```{r frequency}
top20_language_summary %<>% order_language_by("frequency_rank", reverse = TRUE)
ggplot(top20_language_summary) +
  aes(language_ordered, frequency) +
  geom_bar(stat = "identity") +
  coord_flip() +
  labs(x = "", y = "", title = "Frequency")
```

```{r experience}
top20_language_summary %<>% order_language_by("years_used_rank", reverse = TRUE)
ggplot(top20_language_summary) +
  aes(language_ordered, years_used) +
  geom_bar(stat = "identity") +
  coord_flip() +
  labs(x = "", y = "average years used", title = "Experience")
```

```{r proficiency}
top20_language_summary %<>% order_language_by("proficiency_rank", reverse = TRUE)
ggplot(top20_language_summary) +
  aes(language_ordered, proficiency) +
  geom_point(stat = "identity") +
  xlab("") +
  coord_flip(ylim = c(1, 5)) +
  labs(x = "", title = "Proficiency")
```

# Language ratings

```{r, echo=1}
language_ratings <- collect_table("language_ratings")
kable(head(language_ratings))
```

## Intuitiveness

```{r intuitiveness}
source("R/question-types.R")

intuitiveness <- collect_table("language_ratings") %>%
  filter(question_name == "intuitiveness") %>%
  select(subj_id, language_name, question_tag, agreement_num) %>%
  drop_na() %>%
  group_by(language_name, question_tag) %>%
  summarize(
    n = n(),
    agreement_num = mean(agreement_num, na.rm = TRUE)
  ) %>%
  ungroup()

top20_intuitive <- filter(intuitiveness, language_name %in% top20_languages)

intuitive_for_all <- top20_intuitive %>%
  filter(question_tag == "forAll") %>%
  arrange(agreement_num) %>%
  .$language_name

top20_intuitive$language_ordered <- factor(top20_intuitive$language_name, levels = intuitive_for_all)

ggplot(top20_intuitive) +
  aes(language_ordered, agreement_num) +
  geom_point() +
  coord_flip(ylim = 1:5) +
  scale_y_continuous("Agreement", breaks = 1:5) +
  facet_wrap("question_tag") +
  xlab("")
```

## Reuse

```{r reuse}
reuse <- collect_table("language_ratings") %>%
  filter(question_name == "reuse") %>%
  select(subj_id, language_name, question_tag, agreement_num) %>%
  drop_na() %>%
  group_by(language_name, question_tag) %>%
  summarize(
    n = n(),
    agreement_num = mean(agreement_num, na.rm = TRUE)
  ) %>%
  ungroup()

top20_reuse <- filter(reuse, language_name %in% top20_languages)



ggplot(top20_reuse) +
  aes(language_name, agreement_num) +
  geom_point() +
  coord_flip(ylim = 1:5) +
  scale_y_continuous("Agreement", breaks = 1:5) +
  facet_wrap("question_tag")
```
